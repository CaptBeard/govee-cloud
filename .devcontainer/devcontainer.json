// See https://aka.ms/vscode-remote/devcontainer.json for format details.
{
	// for development container on remote pi we need to clone source into the remote container, instead of bind:
	"workspaceFolder": "/workspaces/hacs-govee",
	"workspaceMount": "source=/usr/share/hassio/share/dev/hacs-govee,target=/workspaces/hacs-govee,type=bind,consistency=delegated",
	// "remoteEnv": {
	// 	"WS_PATH": "..",
	// },
	// "containerEnv": {
	// 	"WS_PATH": "/usr/share/hassio/share/dev/hacs-govee",
	// },
	"image": "ludeeus/container:python-base-debian",
	//"vsch.local.folder": "/usr/share/hassio/share/dev/hacs-govee",
	//"dockerFile": "Dockerfile",
	"name": "Govee integration development",
	"context": "..",
	"appPort": [
		"9123:8123"
	],
	"postCreateCommand": "/bin/echo ------------ postCreateCommand apt-get ------------ && apt-get update && apt-get -y install bash bluetooth bluez bluez-tools build-essential ca-certificates cython gcc git iputils-ping libatomic1 libavcodec-dev libc-dev libffi-dev libjpeg-dev libpcap-dev libssl-dev make nano openssh-client procps python3 python3-dev python3-dev python3-pip python3-setuptools rfkill unzip wget wget zlib1g-dev && /bin/echo ------------ postCreateCommand python/pip ------------ && /usr/local/bin/python3 -m pip install --upgrade pip && /usr/local/bin/pip3 install black colorlog pylint debugpy pygatt PyNaCl==1.3.0 && /usr/local/bin/pip3 install -r /workspaces/hacs-govee/requirements_test.txt && /bin/echo ------------ postCreateCommand container install ------------ && mkdir -p /src/ludeeus && cd /src/ludeeus && git clone https://github.com/ludeeus/container && cp -r ./container/rootfs/common/* / && chmod +x /usr/bin/container && /usr/bin/container install && /bin/echo ------------ postCreateCommand symlink our component ------------ && /bin/mkdir -p /config/custom_components && /bin/ln -s /workspaces/hacs-govee/custom_components/govee /config/custom_components/govee && /bin/echo ------------ postCreateCommand install hacs ------------ && mkdir -p /src/hacs && cd /src/hacs && /bin/mkdir -p /config/custom_components/hacs && /usr/bin/wget https://github.com/hacs/integration/releases/latest/download/hacs.zip && /usr/bin/unzip hacs.zip -d /config/custom_components/hacs && /bin/rm hacs.zip && /bin/echo ------------ postCreateCommand finished, starting HASS ------------ ",
	"extensions": [
		"ms-python.python",
		"github.vscode-pull-request-github",
		"ryanluker.vscode-coverage-gutters",
		"ms-python.vscode-pylance",
		"littlefoxteam.vscode-python-test-adapter",
		"hbenl.vscode-test-explorer",
		"tht13.python",
		"mhutchie.git-graph"
	],
	"settings": {
		"files.eol": "\n",
		"editor.tabSize": 4,
		"terminal.integrated.shell.linux": "/bin/bash",
		"python.pythonPath": "/usr/bin/python3",
		"python.analysis.autoSearchPaths": false,
		"python.linting.pylintEnabled": true,
		"python.linting.enabled": true,
		"python.formatting.provider": "black",
		"editor.formatOnPaste": false,
		"editor.formatOnSave": true,
		"editor.formatOnType": true,
		"files.trimTrailingWhitespace": true,
		// to develop on your raspberry pi 4 (for BLE):
		"docker.host": "ssh://root@192.168.144.5",
		// also set docker.host for this workspace in vscode
		// create keys with "ssh-keygen -t rsa -b 4096"
		// also run this on your pi
		// copy your local id-rsa.pub content to /root/.ssh/authorized_keys
		// then configure remote-ssh to use key auth: "Remote-SSH: Open Configuration file":
		// Host 192.168.144.5
		//   HostName 192.168.144.5
		//   User root
		//   ForwardAgent yes
		//   IdentityFile C:\Users\root\.ssh\id_rsa
		// then in "Remote Containers: Re-build and re-open in container"
	},
	"runArgs": [
		"--name", "devcontainer_govee",
		"--network",
		"host",
		"--privileged",
		"-v",
		"/etc/machine-id:/etc/machine-id:ro",
		"-v",
		"/run/dbus:/run/dbus:ro",
		"-v",
		"/dev:/dev:ro",
		"-v",
		"/run/udev:/run/udev:ro",
	]
}